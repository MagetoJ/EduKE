# ==================================
# EduKE Render Blueprint (render.yaml)
# ==================================

services:
  # -----------------
  # Backend API (Node.js/Express)
  # -----------------
  - type: web
    name: eduke-server
    env: node
    # Specifies that the backend code is in the 'server' directory
    rootDir: server
    buildCommand: npm install
    startCommand: node index.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      # !! IMPORTANT !!
      # You MUST set the following in your Render Environment:
      # 1. DATABASE_URL: Get this from your Render Postgres DB's "External URL"
      # 2. JWT_SECRET: Generate a new strong random string
      # 3. JWT_REFRESH_SECRET: Generate another new strong random string
      # 4. CORS_ORIGIN: Set this to the URL of your frontend service (e.g., https://eduke-client.onrender.com)
      - key: DATABASE_URL
        fromDatabase:
          name: eduke-database # Name of your Render Postgres database
          property: connectionString
      - key: CORS_ORIGIN
        value: https://eduke-client.onrender.com # default, change if your client name is different

  # -----------------
  # Frontend Client (React/Vite)
  # -----------------
  - type: static
    name: eduke-client
    env: static
    # Specifies that the frontend code is in the root,
    # and Render should build it from there.
    rootDir: .
    buildCommand: npm install && npm run build
    # Vite's output directory
    publishDir: dist
    # Rewrite rule for client-side routing (React Router)
    routes:
      - type: rewrite
        source: /*
        destination: /index.html